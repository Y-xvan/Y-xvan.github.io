<!-- è§£é”åŠ¨ç”»å®¹å™¨ -->
<div id="unlock-animation-container"></div>

<style>
/* è§£é”åŠ¨ç”» */
#unlock-animation-container {
  position: fixed;
  bottom: -200px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10001;
  pointer-events: none;
  transition: bottom 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

#unlock-animation-container.show {
  bottom: 50px;
}

.unlock-animation {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 25px 40px;
  border-radius: 20px;
  box-shadow: 0 10px 40px rgba(102, 126, 234, 0.6);
  display: flex;
  align-items: center;
  gap: 20px;
  border: 3px solid rgba(255, 255, 255, 0.8);
}

.unlock-icon {
  font-size: 60px;
  animation: unlockBounce 0.6s ease-in-out;
}

@keyframes unlockBounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.3) rotate(10deg); }
}

.unlock-content h3 {
  color: #fff;
  font-size: 24px;
  font-weight: 800;
  margin: 0 0 5px 0;
  text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

.unlock-content p {
  color: rgba(255, 255, 255, 0.9);
  font-size: 14px;
  margin: 0;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .unlock-animation {
    padding: 20px 25px;
    flex-direction: column;
    text-align: center;
  }
}
</style>

<script>
(function() {
  const MUYU_UNLOCK_THRESHOLD = 1;   // æœ¨é±¼ç•Œé¢è§£é”éœ€è¦çš„æ¬¡æ•°
  const DOG_UNLOCK_THRESHOLD = 66;   // å°ç‹—è§£é”éœ€è¦çš„æ¬¡æ•°

  // Achievement System Configuration
  const ACHIEVEMENTS = [
    { count: 1, id: 'beginner', icon: 'ğŸ™', title: 'First Step', desc: 'Welcome to the journey!' },
    { count: 10, id: 'diligent', icon: 'ğŸ“š', title: 'Diligent Scholar', desc: 'Every click counts' },
    { count: 33, id: 'progress', icon: 'ğŸŒŸ', title: 'Making Progress', desc: 'First milestone reached' },
    { count: 66, id: 'companion', icon: 'ğŸ•', title: 'Best Friend', desc: 'Pet Dog Unlocked!' },
    { count: 99, id: 'persistence', icon: 'ğŸ’ª', title: 'Persistent Spirit', desc: 'The path to mastery' },
    { count: 168, id: 'allNighter', icon: 'ğŸŒ™', title: 'Night Owl', desc: 'A full week of dedication' },
    { count: 233, id: 'fibonacci', icon: 'ğŸ”¢', title: 'Fibonacci Blessing', desc: 'Beauty of mathematics' },
    { count: 365, id: 'yearlyContributor', icon: 'ğŸ“…', title: 'Year-Round Devotion', desc: 'A full year of commitment' },
    { count: 520, id: 'loveResearch', icon: 'â¤ï¸', title: 'True Passion', desc: 'Love for the work' },
    { count: 666, id: 'devilTraining', icon: 'ğŸ˜ˆ', title: 'Devil\'s Advocate', desc: 'Peak performance achieved' },
    { count: 888, id: 'perfect', icon: 'ğŸŠ', title: 'Triple Fortune', desc: 'Prosperity and luck' },
    { count: 1024, id: 'programmer', icon: 'ğŸ’»', title: 'Binary Master', desc: '2^10 = Perfection' }
  ];

  // åˆ›ä½œè€…ä»£ç æˆå°±ç³»ç»Ÿï¼ˆå…¨éƒ¨ä½¿ç”¨ä¸­æ–‡æ˜¾ç¤ºï¼‰
  // æ³¨æ„ï¼šæ­¤åŒºåŸŸåªæœ‰åœ¨è¾“å…¥yuzhixuanè§£é”å¼€å‘è€…æ¨¡å¼åæ‰ä¼šæ˜¾ç¤º
  const CREATOR_CODE_ACHIEVEMENTS = [
    { id: 'konami_code', icon: 'ğŸ®', title: 'ç»å…¸å¯†ç ', titleEn: 'Konami Code', desc: 'å‘ç°äº†ç»å…¸çš„Konami Code', code: 'â†‘â†“â†‘â†“â†â†’â†â†’', trigger: 'è¾“å…¥æ–¹å‘é”®åºåˆ—' },
    { id: 'developer_mode', icon: 'ğŸ‘¨â€ğŸ’»', title: 'å¼€å‘è€…æ¨¡å¼', titleEn: 'Developer Mode', desc: 'è§£é”äº†æ‰€æœ‰éšè—åŠŸèƒ½', code: 'yuzhixuan', trigger: 'é”®å…¥å¼€å‘è€…å¯†ç ' },
    { id: 'clear_cache', icon: 'ğŸ§¹', title: 'é‡ç½®å¤§å¸ˆ', titleEn: 'Cache Cleaner', desc: 'æ¸…é™¤äº†æ‰€æœ‰ç¼“å­˜æ•°æ®', code: 'clearcache', trigger: 'é”®å…¥æ¸…é™¤å¯†ç ' }
  ];

  let unlockedCreatorCodes = []; // å·²è§£é”çš„åˆ›ä½œè€…ä»£ç æˆå°±

  let muyuTotalClicks = 0;  // ç´¯è®¡æœ¨é±¼ç‚¹å‡»æ¬¡æ•°
  let muyuUnlocked = false;
  let dogUnlocked = false;
  let gachaUnlocked = false;  // æ‰­è›‹æœºè§£é”çŠ¶æ€
  let matrixUnlocked = false; // Matrix ä»£ç é›¨è§£é”çŠ¶æ€
  let timeDiaryUnlocked = false; // æ—¶é—´æ—…è¡Œè€…æ—¥è®°è§£é”çŠ¶æ€
  let explorerUnlocked = false; // æ¢ç´¢è€…æˆå°±è§£é”çŠ¶æ€
  let unlockedAchievements = []; // å·²è§£é”çš„æˆå°±åˆ—è¡¨

  // ä» localStorage è¯»å–è§£é”çŠ¶æ€
  function loadUnlockStatus() {
    muyuTotalClicks = parseInt(localStorage.getItem('muyuTotalClicks') || '0');
    muyuUnlocked = localStorage.getItem('muyuUnlocked') === 'true';
    dogUnlocked = localStorage.getItem('dogUnlocked') === 'true';
    gachaUnlocked = localStorage.getItem('gachaUnlocked') === 'true';
    matrixUnlocked = localStorage.getItem('matrixUnlocked') === 'true';
    timeDiaryUnlocked = localStorage.getItem('timeDiaryUnlocked') === 'true';
    explorerUnlocked = localStorage.getItem('explorerUnlocked') === 'true';
    unlockedAchievements = JSON.parse(localStorage.getItem('unlockedAchievements') || '[]');
    unlockedCreatorCodes = JSON.parse(localStorage.getItem('unlockedCreatorCodes') || '[]');

    updateUI();
  }

  // ä¿å­˜è§£é”çŠ¶æ€
  function saveUnlockStatus() {
    localStorage.setItem('muyuTotalClicks', muyuTotalClicks);
    localStorage.setItem('muyuUnlocked', muyuUnlocked);
    localStorage.setItem('dogUnlocked', dogUnlocked);
    localStorage.setItem('gachaUnlocked', gachaUnlocked);
    localStorage.setItem('matrixUnlocked', matrixUnlocked);
    localStorage.setItem('timeDiaryUnlocked', timeDiaryUnlocked);
    localStorage.setItem('explorerUnlocked', explorerUnlocked);
    localStorage.setItem('unlockedAchievements', JSON.stringify(unlockedAchievements));
    localStorage.setItem('unlockedCreatorCodes', JSON.stringify(unlockedCreatorCodes));
  }

  // æ›´æ–°UI
  function updateUI() {
    // æ›´æ–°è¿›åº¦æ¡
    const progressBar = document.getElementById('muyu-progress-bar');
    const progressText = document.getElementById('muyu-progress-text');
    const progress = Math.min((muyuTotalClicks / DOG_UNLOCK_THRESHOLD) * 100, 100);

    if (progressBar) progressBar.style.width = progress + '%';
    if (progressText) progressText.textContent = `${muyuTotalClicks} / ${DOG_UNLOCK_THRESHOLD}`;

    // æ›´æ–°æœ¨é±¼é¡¹ç›®çŠ¶æ€
    const muyuItem = document.getElementById('secret-item-muyu');
    const muyuStatus = muyuItem?.querySelector('.secret-item-status');
    if (muyuUnlocked && muyuItem) {
      muyuItem.classList.remove('locked');
      muyuItem.classList.add('unlocked');
      if (muyuStatus) {
        muyuStatus.classList.remove('locked');
        muyuStatus.classList.add('unlocked');
        muyuStatus.textContent = 'UNLOCKED';
      }
    }

    // æ›´æ–°å°ç‹—é¡¹ç›®çŠ¶æ€
    const dogItem = document.getElementById('secret-item-dog');
    const dogStatus = dogItem?.querySelector('.secret-item-status');
    if (dogUnlocked && dogItem) {
      dogItem.classList.remove('locked');
      dogItem.classList.add('unlocked');
      if (dogStatus) {
        dogStatus.classList.remove('locked');
        dogStatus.classList.add('unlocked');
        dogStatus.textContent = 'UNLOCKED';
      }
    }

    // æ›´æ–°åŠŸå¾·è®¡æ•°å™¨æ˜¾ç¤º
    const meritContainer = document.getElementById('muyu-container');
    if (meritContainer) {
      meritContainer.style.display = muyuUnlocked ? 'block' : 'none';
    }

    // æ›´æ–°å°ç‹—æŒ‰é’®æ˜¾ç¤º
    const dogButton = document.getElementById('dog-house-button');
    if (dogButton) {
      dogButton.style.display = dogUnlocked ? 'flex' : 'none';
    }

    // æ›´æ–°æ‰­è›‹æœºæŒ‰é’®æ˜¾ç¤º
    const gachaButton = document.getElementById('gacha-button');
    if (gachaButton) {
      gachaButton.style.display = gachaUnlocked ? 'flex' : 'none';
    }

    // æ›´æ–° Matrix ä»£ç é›¨æŒ‰é’®æ˜¾ç¤º
    const matrixButton = document.getElementById('matrix-toggle');
    if (matrixButton) {
      matrixButton.style.display = matrixUnlocked ? 'flex' : 'none';
    }
  }

  // æ˜¾ç¤ºè§£é”åŠ¨ç”»
  function showUnlockAnimation(icon, title, description) {
    const container = document.getElementById('unlock-animation-container');

    const animDiv = document.createElement('div');
    animDiv.className = 'unlock-animation';
    animDiv.innerHTML = `
      <div class="unlock-icon">${icon}</div>
      <div class="unlock-content">
        <h3>${title}</h3>
        <p>${description}</p>
      </div>
    `;

    container.innerHTML = '';
    container.appendChild(animDiv);
    container.classList.add('show');

    // 3ç§’åéšè—
    setTimeout(() => {
      container.classList.remove('show');
    }, 3000);
  }

  // å¼€å‘è€…å·¥å…·ï¼šè®¾ç½®æœ¨é±¼ç‚¹å‡»æ•°
  window.setMuyuClicks = function(count) {
    muyuTotalClicks = count;
    checkAchievements();
    saveUnlockStatus();
    updateUI();
    console.log(`æœ¨é±¼ç‚¹å‡»æ•°å·²è®¾ç½®ä¸º: ${count}`);
    console.log(`å·²è§£é”æˆå°±: ${unlockedAchievements.join(', ')}`);
  };

  // æ£€æŸ¥å¹¶è§£é”æˆå°±
  function checkAchievements() {
    ACHIEVEMENTS.forEach(achievement => {
      // å¦‚æœè¾¾åˆ°æˆå°±è¦æ±‚ä¸”è¯¥æˆå°±å°šæœªè§£é”
      if (muyuTotalClicks >= achievement.count && !unlockedAchievements.includes(achievement.id)) {
        unlockedAchievements.push(achievement.id);
        showUnlockAnimation(achievement.icon, achievement.title, achievement.desc);

        // ç‰¹æ®Šæˆå°±è§£é”å¯¹åº”åŠŸèƒ½
        if (achievement.id === 'beginner') {
          muyuUnlocked = true;
        }
        if (achievement.id === 'companion') {
          dogUnlocked = true;
        }
      }
    });
  }

  // å¢åŠ æœ¨é±¼ç‚¹å‡»æ¬¡æ•°ï¼ˆå†…éƒ¨å‡½æ•°ï¼‰
  function incrementMuyuClicks() {
    muyuTotalClicks++;
    checkAchievements();
    saveUnlockStatus();
    updateUI();
  }

  // è§£é”æ‰­è›‹æœºï¼ˆå†…éƒ¨å‡½æ•°ï¼‰
  function unlockGacha() {
    if (gachaUnlocked) return;
    gachaUnlocked = true;
    showUnlockAnimation('ğŸ°', 'ä½ çŸ¥é“å‘è®ºæ–‡å’ŒæŠ½å¥–çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå—ï¼Ÿ', 'Gacha Machine Unlocked!');
    saveUnlockStatus();
    updateUI();
  }

  // è§£é” Matrix ä»£ç é›¨ï¼ˆå†…éƒ¨å‡½æ•°ï¼‰
  function unlockMatrix() {
    if (matrixUnlocked) return;
    matrixUnlocked = true;
    showUnlockAnimation('ğŸ’»', 'å¥½è¿æ°”ï¼', 'Matrix Rain Unlocked!');
    saveUnlockStatus();
    updateUI();
  }

  // è§£é”æ—¶é—´æ—…è¡Œè€…æ—¥è®°ï¼ˆå†…éƒ¨å‡½æ•°ï¼‰
  function unlockTimeDiary() {
    if (timeDiaryUnlocked) return;
    timeDiaryUnlocked = true;
    showUnlockAnimation('â°', 'æ—¶é—´æ—…è¡Œè€…ï¼', 'Time Traveler\'s Diary Unlocked!');
    saveUnlockStatus();
    updateUI();
  }

  // è§£é”æ¢ç´¢è€…æˆå°±ï¼ˆå†…éƒ¨å‡½æ•°ï¼‰
  function unlockExplorer() {
    if (explorerUnlocked) return;
    explorerUnlocked = true;
    showUnlockAnimation('ğŸ—ºï¸', 'æ¢ç´¢è€…ï¼', 'You have visited all pages!');
    saveUnlockStatus();
    updateUI();
  }

  // è¿½è¸ªé¡µé¢è®¿é—®
  function trackPageVisit() {
    const visitedPages = JSON.parse(localStorage.getItem('visitedPages') || '{}');
    const currentPage = window.location.pathname;

    // æ ‡è®°ä¸»é¡µè®¿é—®
    if (currentPage === '/' || currentPage === '/index.html' || currentPage.endsWith('/my_website/')) {
      visitedPages.homepage = true;
    }

    localStorage.setItem('visitedPages', JSON.stringify(visitedPages));

    // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰é¡µé¢éƒ½å·²è®¿é—®
    checkExplorerAchievement();
  }

  // æ£€æŸ¥æ¢ç´¢è€…æˆå°±æ˜¯å¦è¾¾æˆ
  function checkExplorerAchievement() {
    if (explorerUnlocked) return;

    const visitedPages = JSON.parse(localStorage.getItem('visitedPages') || '{}');

    // æ£€æŸ¥æ˜¯å¦è®¿é—®äº†ä¸»é¡µå’Œ GitHub é¡µé¢
    if (visitedPages.homepage && visitedPages.github) {
      unlockExplorer();
    }
  }

  // è¿½è¸ª GitHub é“¾æ¥ç‚¹å‡»ï¼ˆå†…éƒ¨å‡½æ•°ï¼‰
  function trackGitHubVisit() {
    const visitedPages = JSON.parse(localStorage.getItem('visitedPages') || '{}');
    visitedPages.github = true;
    localStorage.setItem('visitedPages', JSON.stringify(visitedPages));
    checkExplorerAchievement();
  }

  // ========== åˆ›ä½œè€…ä»£ç æˆå°±ç³»ç»Ÿ ==========

  // è§£é”åˆ›ä½œè€…ä»£ç æˆå°±
  function unlockCreatorCode(codeId, showAnimation = true) {
    if (unlockedCreatorCodes.includes(codeId)) return; // å·²è§£é”ï¼Œä¸é‡å¤è§¦å‘

    const achievement = CREATOR_CODE_ACHIEVEMENTS.find(a => a.id === codeId);
    if (!achievement) return;

    unlockedCreatorCodes.push(codeId);

    if (showAnimation) {
      // ä½¿ç”¨ä¸­æ–‡æ ‡é¢˜æ˜¾ç¤ºè§£é”åŠ¨ç”»
      showUnlockAnimation(achievement.icon, achievement.title, achievement.desc);
    }

    // åœ¨æ§åˆ¶å°è¾“å‡ºï¼ˆå¸¦ä¸­è‹±æ–‡åŒè¯­ï¼‰
    console.log(`ğŸ‰ åˆ›ä½œè€…ä»£ç æˆå°±è§£é”ï¼/ Creator Code Achievement Unlocked!`);
    console.log(`   ${achievement.icon} ${achievement.title} (${achievement.titleEn})`);
    console.log(`   ${achievement.desc}`);
    console.log(`   è§¦å‘æ–¹å¼: ${achievement.trigger}`);

    saveUnlockStatus();
  }

  // å„ä¸ªåˆ›ä½œè€…ä»£ç çš„è§£é”å‡½æ•°ï¼ˆå†…éƒ¨å‡½æ•°ï¼‰
  function unlockKonamiCode() {
    unlockCreatorCode('konami_code');
  }

  function unlockDeveloperCode() {
    unlockCreatorCode('developer_mode');
  }

  function unlockClearCache() {
    unlockCreatorCode('clear_cache');
  }

  // åˆå§‹åŒ–
  document.addEventListener('DOMContentLoaded', function() {
    loadUnlockStatus();
    // æ£€æŸ¥æ˜¯å¦æœ‰é—æ¼çš„æˆå°±ï¼ˆä»£ç æ›´æ–°åï¼‰
    checkAchievements();
    saveUnlockStatus();
    trackPageVisit();

    // ç›‘å¬ Papers é“¾æ¥ç‚¹å‡»æ¥è§£é”æ‰­è›‹æœº
    const papersLinks = document.querySelectorAll('a[href*="papers"], a[href="#papers"]');
    papersLinks.forEach(link => {
      link.addEventListener('click', function() {
        if (!gachaUnlocked) {
          // å»¶è¿Ÿä¸€ä¸‹ï¼Œè®©ç”¨æˆ·çœ‹åˆ°ç‚¹å‡»æ•ˆæœ
          setTimeout(() => {
            unlockGacha();
          }, 300);
        }
      });
    });

    // ç›‘å¬ GitHub é“¾æ¥ç‚¹å‡»æ¥è¿½è¸ªæ¢ç´¢è€…æˆå°±
    const githubLinks = document.querySelectorAll('a[href*="github.com/Y-xvan"]');
    githubLinks.forEach(link => {
      link.addEventListener('click', function() {
        trackGitHubVisit();
      });
    });
  });
})();
</script>
